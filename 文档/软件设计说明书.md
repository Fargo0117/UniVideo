好的，这是为你定制的**《软件设计说明书》**完整内容。

这份文档是根据我们商定的 **UniVideo（校园视界）** 项目需求，结合 **Python (Flask) + Vue + MySQL** 技术栈，并严格按照你提供的《软件工程课程设计指导书》1 附录4和附录5的规范整合编写的。



你可以直接将以下内容复制到你的 Word 文档 **`软件设计说明书_软工231_01_张某.doc`** 中。

------

# 软件设计说明书

## 1. 引言

### 1.1 编写目的

本说明书旨在详细阐述 **UniVideo（校园视界）** 系统的设计方案，包括系统架构、数据库设计、接口定义及核心业务逻辑。文档明确了系统的物理结构和逻辑结构，为后续的编码实现、测试及系统维护提供主要的技术依据。预期的读者包括项目开发人员、测试人员及指导教师。

### 1.2 项目背景

- **项目名称：** UniVideo 校园视界
- **开发者：** 软工231班 张某
- **项目性质：** 软件工程课程设计
- **技术栈：** 后端 Python (Flask), 前端 Vue.js, 数据库 MySQL 8.0

### 1.3 定义

- **先审后发 (Pre-audit)：** 指用户上传视频后，系统仅将状态置为“待审核”，只有经管理员后台确认通过后，视频才会在前台公开展示的机制。
- **根评论 (Root Comment)：** 指直接对视频发表的一级评论。
- **二级评论 (Nested Comment)：** 指对已有评论进行的回复。在本系统中，为优化查询，所有属于同一楼层的回复（无论嵌套多少层）均关联至同一个根评论 ID。

### 1.4 参考资料

1. 《软件工程课程设计指导书》 2

   

   

2. UniVideo 需求分析规格说明书

3. Flask 官方文档 (https://flask.palletsprojects.com/)

## 2. 总体设计

### 2.1 运行环境

- **操作系统：** Windows 10/11 或 Linux
- **Web 服务器：** Nginx (生产环境) 或 Flask Built-in Server (开发环境)
- **数据库服务器：** MySQL 8.0+
- **开发语言：** Python 3.8+, JavaScript (Vue 3)

### 2.2 系统架构设计

本系统采用标准的 **B/S (Browser/Server)** 架构，前后端分离开发：

- **前端 (Frontend)：** 使用 Vue.js 框架构建单页面应用 (SPA)，负责页面渲染、用户交互及视频播放。通过 Axios 与后端进行 HTTP 通信。
- **后端 (Backend)：** 使用 Python Flask 框架提供 RESTful API 接口，处理业务逻辑（如文件上传、权限验证）。
- **数据库 (Database)：** MySQL 存储结构化数据（用户、元数据、评论），视频文件和图片资源直接存储于服务器本地文件系统 (`/static` 目录)。

### 2.3 功能模块结构

系统主要划分为 **前台用户子系统** 和 **后台管理子系统**：

1. **用户模块：** 注册、登录、个人信息修改。
2. **视频模块：**
   - **浏览：** 首页推荐、分类筛选、视频详情页、流媒体播放。
   - **投稿：** 视频上传、封面上传、元数据填写（标题/简介/分类）。
3. **互动模块：** 点赞、发表评论（支持二级回复）、删除自己的评论。
4. **管理模块：**
   - **审核：** 查看待审核视频列表、播放预览、通过/驳回操作。
   - **内容管理：** 强制下架违规视频、管理分类标签。

## 3. 数据库设计 (Database Design)

### 3.1 逻辑结构设计

根据业务需求，系统共设计 5 张数据表，均满足第三范式 (3NF)。

### 3.2 物理结构设计

数据库名：`univideo_db`，字符集：`utf8mb4`。

#### 1. 用户表 (`users`)

| **字段名**   | **类型** | **长度** | **空** | **键** | **描述**                                  |
| ------------ | -------- | -------- | ------ | ------ | ----------------------------------------- |
| `id`         | INT      | 11       | 否     | PK     | 自增主键                                  |
| `username`   | VARCHAR  | 50       | 否     | UK     | 登录账号 (学号)                           |
| `password`   | VARCHAR  | 255      | 否     |        | 加密后的密码散列值                        |
| `nickname`   | VARCHAR  | 50       | 否     |        | 用户昵称                                  |
| `role`       | VARCHAR  | 20       | 否     |        | 角色：`user` (普通用户), `admin` (管理员) |
| `avatar`     | VARCHAR  | 255      | 是     |        | 头像路径                                  |
| `created_at` | DATETIME |          | 是     |        | 注册时间                                  |

#### 2. 视频分类表 (`categories`)

| **字段名** | **类型** | **长度** | **空** | **键** | **描述**                |
| ---------- | -------- | -------- | ------ | ------ | ----------------------- |
| `id`       | INT      | 11       | 否     | PK     | 自增主键                |
| `name`     | VARCHAR  | 50       | 否     | UK     | 分类名称 (如：校园生活) |

#### 3. 视频信息表 (`videos`)

| **字段名**    | **类型** | **长度** | **空** | **键** | **描述**                       |
| ------------- | -------- | -------- | ------ | ------ | ------------------------------ |
| `id`          | INT      | 11       | 否     | PK     | 自增主键                       |
| `user_id`     | INT      | 11       | 否     | FK     | 上传用户 ID                    |
| `category_id` | INT      | 11       | 否     | FK     | 分类 ID                        |
| `title`       | VARCHAR  | 100      | 否     |        | 视频标题                       |
| `description` | TEXT     |          | 是     |        | 视频简介                       |
| `cover_path`  | VARCHAR  | 255      | 否     |        | 封面图片存储路径               |
| `video_path`  | VARCHAR  | 255      | 否     |        | 视频文件存储路径               |
| `status`      | TINYINT  | 4        | 是     | IDX    | **0=待审核, 1=已发布, 2=驳回** |
| `view_count`  | INT      | 11       | 是     |        | 播放次数                       |
| `created_at`  | DATETIME |          | 是     |        | 上传时间                       |

#### 4. 评论表 (`comments`)

特别说明：为优化二级评论查询，引入 root_id 字段。

| 字段名 | 类型 | 长度 | 空 | 键 | 描述 |

| :--- | :--- | :--- | :--- | :--- | :--- |

| id | INT | 11 | 否 | PK | 自增主键 |

| user_id | INT | 11 | 否 | FK | 评论者 ID |

| video_id | INT | 11 | 否 | FK | 所属视频 ID |

| parent_id | INT | 11 | 是 | FK | 父评论 ID (直接回复的对象) |

| root_id | INT | 11 | 是 | FK | 根评论 ID (所属的一级评论 ID) |

| content | TEXT | | 否 | | 评论内容 |

| created_at | DATETIME | | 是 | | 评论时间 |

*索引说明：建立联合索引 `idx_video_root` (`video_id`, `root_id`)，用于快速拉取某视频下的评论楼层。*

#### 5. 点赞表 (`likes`)

| **字段名** | **类型** | **长度** | **空** | **键** | **描述** |
| ---------- | -------- | -------- | ------ | ------ | -------- |
| `id`       | INT      | 11       | 否     | PK     | 自增主键 |
| `user_id`  | INT      | 11       | 否     | FK     | 用户 ID  |
| `video_id` | INT      | 11       | 否     | FK     | 视频 ID  |

*约束说明：建立唯一约束 (`user_id`, `video_id`) 防止重复点赞。*

## 4. 接口设计 (Interface Design)

后端 API 均基于 HTTP 协议，返回 JSON 格式数据。通用响应结构：`{ "code": 200, "msg": "success", "data": {} }`。

### 4.1 认证模块

- `POST /api/auth/register`: 用户注册
- `POST /api/auth/login`: 用户登录 (返回 JWT Token)
- `GET /api/auth/me`: 获取当前用户信息

### 4.2 视频模块

- `POST /api/videos/upload`: 上传视频 (Multipart/form-data，包含视频文件、封面、标题、分类)
- `GET /api/videos`: 获取视频列表 (参数: `page`, `category_id`, `keyword`)
  - *逻辑：* 仅返回 `status = 1` (已发布) 的视频。
- `GET /api/videos/<id>`: 获取视频详情 (包含播放地址、作者信息)
- `GET /static/videos/<filename>`: 视频流媒体访问接口

### 4.3 互动模块

- `POST /api/videos/<id>/comments`: 发表评论
  - *输入：* `content`, `parent_id` (可选)
  - *逻辑：* 后端自动计算 `root_id`。
- `GET /api/videos/<id>/comments`: 获取评论列表 (按 `root_id` 分组返回树状结构)
- `POST /api/videos/<id>/like`: 点赞/取消点赞

### 4.4 管理员模块

- `GET /api/admin/audit/list`: 获取待审核视频列表 (筛选 `status = 0`)
- `POST /api/admin/audit/<id>`: 审核操作
  - *输入：* `action` ("approve" 或 "reject")
  - *逻辑：* 修改数据库 `status` 字段。

## 5. 详细设计 (Detailed Design)

### 5.1 视频上传与存储流程

1. 用户前端填写表单，选择视频文件 (.mp4) 和封面图片 (.jpg/.png)。
2. 前端通过 `FormData` 将文件发送至后端 `/upload` 接口。
3. **后端处理：**
   - 校验文件格式后缀。
   - 生成唯一文件名 (UUID + 时间戳)，防止重名覆盖。
   - 将文件保存至服务器 `/static/videos` 和 `/static/covers` 文件夹。
   - 向 `videos` 表插入一条记录，设置 `status = 0` (待审核)。
4. 返回上传成功信息，提示用户“等待审核”。

### 5.2 评论回复逻辑设计

为实现高效的二级评论检索，写入与查询逻辑如下：

- **写入逻辑 (Python):**

  Python

  ```
  if parent_id is None:
      # 这是一级评论
      new_comment.root_id = None
  else:
      # 这是回复
      parent_comment = Comment.query.get(parent_id)
      # 如果父评论本身也是回复，则继承其 root_id；否则父评论就是 root
      new_comment.root_id = parent_comment.root_id if parent_comment.root_id else parent_comment.id
  ```

- 查询逻辑 (SQL):

  前端请求评论列表时，后端先查出所有 video_id = X 且 root_id IS NULL 的记录（一级评论），再根据这些 ID 查询对应的子评论，在内存中组装成树状结构返回。

### 5.3 权限控制设计

- 使用 JWT (JSON Web Token) 进行身份验证。
- 普通接口（如上传、评论）需验证 Token 有效性。
- 管理接口（如 `/api/admin/*`）需额外验证用户数据库字段 `role == 'admin'`，否则返回 403 Forbidden。

------

### 下一步提示

现在文档已经齐备。如果你准备好了，我们可以开始生成代码了。请告诉我：

“请帮我规划 Flask 后端的项目结构，并生成核心的 app.py 和 models.py 代码。”