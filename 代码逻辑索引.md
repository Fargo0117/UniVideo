# UniVideo ä»£ç é€»è¾‘ç´¢å¼•

> æœ¬æ–‡æ¡£ç”¨äºæ¢³ç† UniVideo é¡¹ç›®çš„ä»£ç ç»“æ„å’Œé€»è¾‘å…³ç³»ï¼Œä¾¿äºå¼€å‘è€…å’ŒAIç†è§£é¡¹ç›®æ¶æ„ã€‚

---

## ğŸ“‹ ç›®å½•

1. [é¡¹ç›®æ•´ä½“æ¶æ„](#1-é¡¹ç›®æ•´ä½“æ¶æ„)
2. [åç«¯ä»£ç ç»“æ„](#2-åç«¯ä»£ç ç»“æ„)
3. [å‰ç«¯ä»£ç ç»“æ„](#3-å‰ç«¯ä»£ç ç»“æ„)
4. [æ•°æ®åº“æ¨¡å‹å…³ç³»](#4-æ•°æ®åº“æ¨¡å‹å…³ç³»)
5. [APIè·¯ç”±ç»“æ„](#5-apiè·¯ç”±ç»“æ„)
6. [ä¸»è¦åŠŸèƒ½æ¨¡å—](#6-ä¸»è¦åŠŸèƒ½æ¨¡å—)
7. [æ•°æ®æµè½¬é€»è¾‘](#7-æ•°æ®æµè½¬é€»è¾‘)

---

## 1. é¡¹ç›®æ•´ä½“æ¶æ„

### 1.1 æŠ€æœ¯æ ˆ

**åç«¯**
- æ¡†æ¶ï¼šFlask (Python)
- æ•°æ®åº“ï¼šMySQL (é€šè¿‡ SQLAlchemy ORM)
- è¿ç§»å·¥å…·ï¼šFlask-Migrate (Alembic)
- æ–‡ä»¶å­˜å‚¨ï¼šæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ (`backend/static/`)

**å‰ç«¯**
- æ¡†æ¶ï¼šVue 3 (Composition API)
- è·¯ç”±ï¼šVue Router
- HTTPå®¢æˆ·ç«¯ï¼šAxios
- æ„å»ºå·¥å…·ï¼šVite

### 1.2 é¡¹ç›®ç»“æ„

```
UniVideo/
â”œâ”€â”€ backend/                    # åç«¯ Flask åº”ç”¨
â”‚   â”œâ”€â”€ app.py                 # åº”ç”¨å…¥å£ï¼šåˆ›å»ºFlaskå®ä¾‹ï¼Œæ³¨å†Œè“å›¾
â”‚   â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶ï¼šå¼€å‘/æµ‹è¯•/ç”Ÿäº§ç¯å¢ƒé…ç½®
â”‚   â”œâ”€â”€ models.py              # æ•°æ®åº“æ¨¡å‹ï¼šUser, Video, Commentç­‰
â”‚   â”œâ”€â”€ init_db.py             # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”‚   â”œâ”€â”€ routes/                # è·¯ç”±æ¨¡å—ï¼ˆè“å›¾ï¼‰
â”‚   â”‚   â”œâ”€â”€ auth.py            # è®¤è¯è·¯ç”±ï¼šæ³¨å†Œã€ç™»å½•
â”‚   â”‚   â”œâ”€â”€ video.py           # è§†é¢‘è·¯ç”±ï¼šä¸Šä¼ ã€åˆ—è¡¨ã€è¯¦æƒ…
â”‚   â”‚   â”œâ”€â”€ user.py            # ç”¨æˆ·è·¯ç”±ï¼šä¸ªäººä¸­å¿ƒã€èµ„æ–™ä¿®æ”¹
â”‚   â”‚   â”œâ”€â”€ admin.py           # ç®¡ç†å‘˜è·¯ç”±ï¼šå®¡æ ¸ã€ç®¡ç†
â”‚   â”‚   â””â”€â”€ interaction.py     # äº’åŠ¨è·¯ç”±ï¼šè¯„è®ºã€ç‚¹èµã€æ”¶è—
â”‚   â””â”€â”€ static/                # é™æ€æ–‡ä»¶å­˜å‚¨
â”‚       â”œâ”€â”€ videos/            # è§†é¢‘æ–‡ä»¶
â”‚       â”œâ”€â”€ covers/            # å°é¢å›¾ç‰‡
â”‚       â””â”€â”€ avatars/           # ç”¨æˆ·å¤´åƒ
â”‚
â””â”€â”€ frontend/                   # å‰ç«¯ Vue åº”ç”¨
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ main.js            # åº”ç”¨å…¥å£ï¼šåˆ›å»ºVueå®ä¾‹
    â”‚   â”œâ”€â”€ App.vue            # æ ¹ç»„ä»¶ï¼šè·¯ç”±è§†å›¾å®¹å™¨
    â”‚   â”œâ”€â”€ api.js             # Axiosé…ç½®ï¼šHTTPå®¢æˆ·ç«¯
    â”‚   â”œâ”€â”€ router/            # è·¯ç”±é…ç½®
    â”‚   â”‚   â””â”€â”€ index.js       # è·¯ç”±å®šä¹‰
    â”‚   â””â”€â”€ views/             # é¡µé¢ç»„ä»¶
    â”‚       â”œâ”€â”€ Home.vue       # é¦–é¡µï¼šè§†é¢‘åˆ—è¡¨
    â”‚       â”œâ”€â”€ Login.vue      # ç™»å½•é¡µ
    â”‚       â”œâ”€â”€ Register.vue   # æ³¨å†Œé¡µ
    â”‚       â”œâ”€â”€ Upload.vue     # ä¸Šä¼ é¡µ
    â”‚       â”œâ”€â”€ VideoDetail.vue # è§†é¢‘è¯¦æƒ…é¡µ
    â”‚       â”œâ”€â”€ Profile.vue    # ä¸ªäººä¸­å¿ƒ
    â”‚       â””â”€â”€ AdminAudit.vue # ç®¡ç†å‘˜å®¡æ ¸é¡µ
    â””â”€â”€ vite.config.js         # Viteé…ç½®
```

---

## 2. åç«¯ä»£ç ç»“æ„

### 2.1 åº”ç”¨å…¥å£ (`backend/app.py`)

**æ ¸å¿ƒå‡½æ•°ï¼š`create_app(config_name='development')`**

åº”ç”¨å·¥å‚æ¨¡å¼ï¼Œè´Ÿè´£ï¼š
1. **åˆ›å»ºFlaskå®ä¾‹**
2. **åŠ è½½é…ç½®**ï¼šä» `config.py` åŠ è½½ç¯å¢ƒé…ç½®
3. **åˆå§‹åŒ–æ‰©å±•**ï¼š
   - `db.init_app(app)` - SQLAlchemyæ•°æ®åº“
   - `Migrate(app, db)` - æ•°æ®åº“è¿ç§»
   - `CORS(app)` - è·¨åŸŸæ”¯æŒ
4. **åˆ›å»ºä¸Šä¼ ç›®å½•**ï¼švideos, covers, avatars
5. **æ³¨å†Œè“å›¾**ï¼š
   ```python
   # è®¤è¯æ¨¡å—
   app.register_blueprint(auth_bp, url_prefix='/api/auth')
   
   # è§†é¢‘æ¨¡å—
   app.register_blueprint(video_bp, url_prefix='/api/videos')
   
   # ç®¡ç†å‘˜æ¨¡å—
   app.register_blueprint(admin_bp, url_prefix='/api/admin')
   
   # äº’åŠ¨æ¨¡å—
   app.register_blueprint(interaction_bp, url_prefix='/api')
   
   # ç”¨æˆ·æ¨¡å—
   app.register_blueprint(user_bp, url_prefix='/api/users')
   ```

**æ ¹è·¯ç”±**
- `GET /` - APIæœåŠ¡çŠ¶æ€æ£€æŸ¥
- `GET /api/health` - å¥åº·æ£€æŸ¥ï¼ˆæ•°æ®åº“è¿æ¥æµ‹è¯•ï¼‰

### 2.2 é…ç½®æ–‡ä»¶ (`backend/config.py`)

**é…ç½®ç±»å±‚æ¬¡ç»“æ„**ï¼š
- `Config` (åŸºç¡€é…ç½®ç±»)
  - `DevelopmentConfig` (å¼€å‘ç¯å¢ƒ)
  - `TestingConfig` (æµ‹è¯•ç¯å¢ƒï¼Œå†…å­˜æ•°æ®åº“)
  - `ProductionConfig` (ç”Ÿäº§ç¯å¢ƒ)

**å…³é”®é…ç½®é¡¹**ï¼š
- `SECRET_KEY` - ä¼šè¯åŠ å¯†å¯†é’¥
- `UPLOAD_FOLDER` - æ–‡ä»¶ä¸Šä¼ ç›®å½•ï¼ˆç»å¯¹è·¯å¾„ï¼‰
- `MAX_CONTENT_LENGTH` - æœ€å¤§ä¸Šä¼ å¤§å°ï¼ˆ500MBï¼‰
- `SQLALCHEMY_DATABASE_URI` - MySQLè¿æ¥URI
- `ALLOWED_VIDEO_EXTENSIONS` - å…è®¸çš„è§†é¢‘æ ¼å¼
- `ALLOWED_IMAGE_EXTENSIONS` - å…è®¸çš„å›¾ç‰‡æ ¼å¼

### 2.3 æ•°æ®åº“æ¨¡å‹ (`backend/models.py`)

**æ¨¡å‹å®šä¹‰ï¼ˆ6ä¸ªæ ¸å¿ƒæ¨¡å‹ï¼‰**ï¼š

#### 2.3.1 User (ç”¨æˆ·æ¨¡å‹)
- **å­—æ®µ**ï¼šid, username, password, nickname, role, avatar, created_at
- **å…³ç³»**ï¼š
  - `videos` - ç”¨æˆ·ä¸Šä¼ çš„è§†é¢‘ï¼ˆä¸€å¯¹å¤šï¼‰
  - `comments` - ç”¨æˆ·å‘è¡¨çš„è¯„è®ºï¼ˆä¸€å¯¹å¤šï¼‰
  - `likes` - ç”¨æˆ·çš„ç‚¹èµè®°å½•ï¼ˆä¸€å¯¹å¤šï¼‰
  - `collections` - ç”¨æˆ·çš„æ”¶è—è®°å½•ï¼ˆä¸€å¯¹å¤šï¼‰
  - `favorites` - ç”¨æˆ·æ”¶è—çš„è§†é¢‘ï¼ˆå¤šå¯¹å¤šï¼Œé€šè¿‡collectionsè¡¨ï¼‰
- **æ–¹æ³•**ï¼š
  - `set_password(password)` - åŠ å¯†å¯†ç 
  - `check_password(password)` - éªŒè¯å¯†ç 
  - `is_admin()` - åˆ¤æ–­æ˜¯å¦ä¸ºç®¡ç†å‘˜
  - `to_dict()` - è½¬æ¢ä¸ºå­—å…¸ï¼ˆAPIå“åº”ï¼‰

#### 2.3.2 Category (åˆ†ç±»æ¨¡å‹)
- **å­—æ®µ**ï¼šid, name
- **å…³ç³»**ï¼š`videos` - åˆ†ç±»ä¸‹çš„è§†é¢‘ï¼ˆä¸€å¯¹å¤šï¼‰

#### 2.3.3 Video (è§†é¢‘æ¨¡å‹) â­æ ¸å¿ƒ
- **å­—æ®µ**ï¼š
  - id, title, description, cover_path, video_path
  - **status** (å…³é”®å­—æ®µ)ï¼š0=å¾…å®¡æ ¸, 1=å·²å‘å¸ƒ, 2=å·²é©³å›
  - view_count, created_at
  - user_id (å¤–é”®), category_id (å¤–é”®)
- **çŠ¶æ€å¸¸é‡**ï¼š
  - `STATUS_PENDING = 0` - å¾…å®¡æ ¸
  - `STATUS_PUBLISHED = 1` - å·²å‘å¸ƒ
  - `STATUS_REJECTED = 2` - å·²é©³å›
- **å…³ç³»**ï¼š
  - `author` - è§†é¢‘ä½œè€…ï¼ˆåå‘å¼•ç”¨ï¼‰
  - `category` - è§†é¢‘åˆ†ç±»ï¼ˆåå‘å¼•ç”¨ï¼‰
  - `comments` - è§†é¢‘çš„è¯„è®ºï¼ˆä¸€å¯¹å¤šï¼‰
  - `likes` - è§†é¢‘çš„ç‚¹èµè®°å½•ï¼ˆä¸€å¯¹å¤šï¼‰
  - `collections` - è§†é¢‘çš„æ”¶è—è®°å½•ï¼ˆä¸€å¯¹å¤šï¼‰
- **æ–¹æ³•**ï¼š
  - `get_likes_count()` - è·å–ç‚¹èµæ•°
  - `get_collections_count()` - è·å–æ”¶è—æ•°
  - `to_dict(include_author=True)` - è½¬æ¢ä¸ºå­—å…¸

#### 2.3.4 Comment (è¯„è®ºæ¨¡å‹) - æ”¯æŒå¤šçº§è¯„è®º
- **å­—æ®µ**ï¼š
  - id, content, created_at
  - user_id (å¤–é”®), video_id (å¤–é”®)
  - **parent_id** - ç›´æ¥çˆ¶è¯„è®ºIDï¼ˆæ”¯æŒå›å¤ï¼‰
  - **root_id** - æ ¹è¯„è®ºIDï¼ˆç”¨äºèšåˆåŒä¸€æ¥¼å±‚çš„å›å¤ï¼‰
- **å…³ç³»**ï¼š
  - `parent` - çˆ¶è¯„è®ºï¼ˆè‡ªå…³è”ï¼‰
  - `children` - å­è¯„è®ºåˆ—è¡¨ï¼ˆåå‘å¼•ç”¨ï¼‰
  - `root` - æ ¹è¯„è®ºï¼ˆè‡ªå…³è”ï¼‰
  - `all_replies` - æ ¹è¯„è®ºä¸‹çš„æ‰€æœ‰å›å¤ï¼ˆåå‘å¼•ç”¨ï¼‰
- **ç´¢å¼•**ï¼š`idx_video_root` (video_id, root_id) - ä¼˜åŒ–æŸ¥è¯¢

#### 2.3.5 Like (ç‚¹èµæ¨¡å‹)
- **å­—æ®µ**ï¼šid, created_at, user_id (å¤–é”®), video_id (å¤–é”®)
- **çº¦æŸ**ï¼šè”åˆå”¯ä¸€çº¦æŸ (user_id, video_id) - é˜²æ­¢é‡å¤ç‚¹èµ

#### 2.3.6 Collection (æ”¶è—æ¨¡å‹)
- **å­—æ®µ**ï¼šid, created_at, user_id (å¤–é”®), video_id (å¤–é”®)
- **çº¦æŸ**ï¼šè”åˆå”¯ä¸€çº¦æŸ (user_id, video_id) - é˜²æ­¢é‡å¤æ”¶è—

### 2.4 è·¯ç”±æ¨¡å— (`backend/routes/`)

#### 2.4.1 è®¤è¯è·¯ç”± (`routes/auth.py`)

**è“å›¾åç§°**ï¼š`auth_bp`  
**URLå‰ç¼€**ï¼š`/api/auth`

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¯´æ˜ |
|------|------|------|------|------|
| `/register` | POST | ç”¨æˆ·æ³¨å†Œ | `{username, password, nickname}` | å¯†ç ä½¿ç”¨werkzeugåŠ å¯† |
| `/login` | POST | ç”¨æˆ·ç™»å½• | `{username, password}` | è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸å«JWTï¼‰ |
| `/me` | GET | è·å–å½“å‰ç”¨æˆ· | Header: `X-User-Id` | é€šè¿‡è¯·æ±‚å¤´ä¼ é€’ç”¨æˆ·ID |

**è®¤è¯æœºåˆ¶**ï¼š
- ç®€åŒ–ç‰ˆè®¤è¯ï¼šé€šè¿‡è¯·æ±‚å¤´ `X-User-Id` ä¼ é€’ç”¨æˆ·ID
- å‰ç«¯åœ¨ localStorage å­˜å‚¨ç”¨æˆ·ID
- æœªä½¿ç”¨JWT Tokenï¼ˆå¯åç»­å‡çº§ï¼‰

#### 2.4.2 è§†é¢‘è·¯ç”± (`routes/video.py`)

**è“å›¾åç§°**ï¼š`video_bp`  
**URLå‰ç¼€**ï¼š`/api/videos`

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¯´æ˜ |
|------|------|------|------|------|
| `/categories` | GET | è·å–åˆ†ç±»åˆ—è¡¨ | æ—  | ç”¨äºä¸Šä¼ é¡µåˆ†ç±»ä¸‹æ‹‰æ¡† |
| `/upload` | POST | ä¸Šä¼ è§†é¢‘ | FormData: `user_id, title, description, category_id, video_file, cover_file` | æ–‡ä»¶ä¿å­˜åˆ°staticç›®å½• |
| `/list` | GET | è·å–è§†é¢‘åˆ—è¡¨ | Query: `keyword`, `category_id` | ä»…è¿”å›status=1(å·²å‘å¸ƒ)çš„è§†é¢‘ |
| `/<id>` | GET | è·å–è§†é¢‘è¯¦æƒ… | è·¯å¾„å‚æ•°ï¼šid | è®¿é—®æ—¶view_count+1 |

**ä¸Šä¼ é€»è¾‘**ï¼š
1. éªŒè¯æ–‡ä»¶æ ¼å¼ï¼ˆè§†é¢‘ï¼šmp4/avi/movç­‰ï¼Œå°é¢ï¼šjpg/png/gifç­‰ï¼‰
2. ç”Ÿæˆå”¯ä¸€æ–‡ä»¶åï¼š`{timestamp}_{uuid}.ext`
3. ä¿å­˜æ–‡ä»¶åˆ°æœåŠ¡å™¨
4. æ ¹æ®ç”¨æˆ·è§’è‰²è®¾ç½®çŠ¶æ€ï¼š
   - **ç®¡ç†å‘˜**ï¼šç›´æ¥å‘å¸ƒï¼ˆstatus=1ï¼‰
   - **æ™®é€šç”¨æˆ·**ï¼šå¾…å®¡æ ¸ï¼ˆstatus=0ï¼‰
5. ä¿å­˜è®°å½•åˆ°æ•°æ®åº“

#### 2.4.3 ç”¨æˆ·è·¯ç”± (`routes/user.py`)

**è“å›¾åç§°**ï¼š`user_bp`  
**URLå‰ç¼€**ï¼š`/api/users`

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¯´æ˜ |
|------|------|------|------|------|
| `/me` | GET | è·å–ç”¨æˆ·ä¿¡æ¯ | Query: `user_id` | è¿”å›ç”¨æˆ·è¯¦ç»†ä¿¡æ¯ |
| `/me` | PUT | æ›´æ–°ç”¨æˆ·èµ„æ–™ | FormData: `user_id, nickname, password, avatar` | æ”¯æŒä¿®æ”¹æ˜µç§°/å¯†ç /å¤´åƒ |
| `/me/videos` | GET | è·å–æˆ‘çš„è§†é¢‘ | Query: `user_id` | è¿”å›ç”¨æˆ·ä¸Šä¼ çš„æ‰€æœ‰è§†é¢‘ï¼ˆå«å„ç§çŠ¶æ€ï¼‰ |
| `/me/collections` | GET | è·å–æˆ‘çš„æ”¶è— | Query: `user_id` | è¿”å›ç”¨æˆ·æ”¶è—çš„å·²å‘å¸ƒè§†é¢‘ |

#### 2.4.4 ç®¡ç†å‘˜è·¯ç”± (`routes/admin.py`)

**è“å›¾åç§°**ï¼š`admin_bp`  
**URLå‰ç¼€**ï¼š`/api/admin`

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¯´æ˜ |
|------|------|------|------|------|
| `/manage/list` | GET | è·å–ç®¡ç†åˆ—è¡¨ | Query: `keyword`, `status` | æ”¯æŒæŒ‰å…³é”®è¯å’ŒçŠ¶æ€ç­›é€‰ |
| `/audit/list` | GET | è·å–å¾…å®¡æ ¸åˆ—è¡¨ | æ—  | è¿”å›status=0çš„è§†é¢‘ï¼ˆæŒ‰æ—¶é—´å‡åºï¼‰ |
| `/audit/<video_id>` | POST | å®¡æ ¸è§†é¢‘ | JSON: `{action: "approve"\|"reject"}` | approve=é€šè¿‡(1), reject=é©³å›(2) |
| `/manage/video/<video_id>` | DELETE | åˆ é™¤è§†é¢‘ | è·¯å¾„å‚æ•°ï¼švideo_id | åˆ é™¤æ–‡ä»¶+æ•°æ®åº“è®°å½• |

**å®¡æ ¸é€»è¾‘**ï¼š
- ä»…èƒ½å®¡æ ¸ status=0 (å¾…å®¡æ ¸) çš„è§†é¢‘
- approve â†’ status=1 (å·²å‘å¸ƒ)
- reject â†’ status=2 (å·²é©³å›)

#### 2.4.5 äº’åŠ¨è·¯ç”± (`routes/interaction.py`)

**è“å›¾åç§°**ï¼š`interaction_bp`  
**URLå‰ç¼€**ï¼š`/api`

| è·¯ç”± | æ–¹æ³• | åŠŸèƒ½ | å‚æ•° | è¯´æ˜ |
|------|------|------|------|------|
| `/videos/<video_id>/comments` | POST | å‘è¡¨è¯„è®º | JSON: `{user_id, content, parent_id?}` | æ”¯æŒå›å¤è¯„è®ºï¼ˆå¤šçº§è¯„è®ºï¼‰ |
| `/videos/<video_id>/comments` | GET | è·å–è¯„è®ºåˆ—è¡¨ | è·¯å¾„å‚æ•°ï¼švideo_id | è¿”å›è§†é¢‘çš„æ‰€æœ‰è¯„è®º |
| `/videos/<video_id>/like` | POST | ç‚¹èµ/å–æ¶ˆ | JSON: `{user_id}` | åˆ‡æ¢ç‚¹èµçŠ¶æ€ |
| `/videos/<video_id>/like/status` | GET | è·å–ç‚¹èµçŠ¶æ€ | Query: `user_id` | è¿”å›æ˜¯å¦å·²ç‚¹èµ |
| `/videos/<video_id>/collect` | POST | æ”¶è—/å–æ¶ˆ | JSON: `{user_id}` | åˆ‡æ¢æ”¶è—çŠ¶æ€ |
| `/videos/<video_id>/collect/status` | GET | è·å–æ”¶è—çŠ¶æ€ | Query: `user_id` | è¿”å›æ˜¯å¦å·²æ”¶è— |

**è¯„è®ºé€»è¾‘ï¼ˆå¤šçº§è¯„è®ºï¼‰**ï¼š
- **ä¸€çº§è¯„è®º**ï¼šparent_id=None, root_id=None
- **å›å¤è¯„è®º**ï¼š
  - å¦‚æœçˆ¶è¯„è®ºæ˜¯ä¸€çº§è¯„è®ºï¼šroot_id = parent_id
  - å¦‚æœçˆ¶è¯„è®ºæ˜¯å›å¤ï¼šroot_id = çˆ¶è¯„è®ºçš„root_id
- é€šè¿‡ `root_id` å¯ä»¥å¿«é€ŸèšåˆåŒä¸€æ¥¼å±‚çš„æ‰€æœ‰å›å¤

---

## 3. å‰ç«¯ä»£ç ç»“æ„

### 3.1 åº”ç”¨å…¥å£ (`frontend/src/main.js`)

```javascript
// åˆ›å»ºVueåº”ç”¨å®ä¾‹
const app = createApp(App)
app.use(router)  // æ³¨å†Œè·¯ç”±
app.mount('#app') // æŒ‚è½½åˆ°DOM
```

### 3.2 è·¯ç”±é…ç½® (`frontend/src/router/index.js`)

**è·¯ç”±å®šä¹‰**ï¼š

| è·¯å¾„ | åç§° | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|------|
| `/` | home | `Home.vue` | é¦–é¡µï¼šè§†é¢‘åˆ—è¡¨ |
| `/login` | login | `Login.vue` | ç™»å½•é¡µ |
| `/register` | register | `Register.vue` | æ³¨å†Œé¡µ |
| `/upload` | upload | `Upload.vue` | è§†é¢‘ä¸Šä¼ é¡µ |
| `/video/:id` | video | `VideoDetail.vue` | è§†é¢‘è¯¦æƒ…é¡µ |
| `/profile` | profile | `Profile.vue` | ä¸ªäººä¸­å¿ƒ |
| `/admin` | admin | `AdminAudit.vue` | ç®¡ç†å‘˜å®¡æ ¸é¡µ |

**è·¯ç”±æ¨¡å¼**ï¼š`createWebHistory` (HTML5 Historyæ¨¡å¼)

### 3.3 APIé…ç½® (`frontend/src/api.js`)

**Axioså®ä¾‹é…ç½®**ï¼š
- `baseURL`: `http://localhost:5001/api`
- `timeout`: 10000ms
- `headers`: `Content-Type: application/json`

**è¯·æ±‚æ‹¦æˆªå™¨**ï¼š
- ä» `localStorage.getItem('user_id')` è·å–ç”¨æˆ·ID
- æ·»åŠ åˆ°è¯·æ±‚å¤´ï¼š`X-User-ID: {user_id}`

### 3.4 é¡µé¢ç»„ä»¶ (`frontend/src/views/`)

**ç»„ä»¶åˆ—è¡¨**ï¼š
- `Home.vue` - é¦–é¡µï¼šè§†é¢‘åˆ—è¡¨å±•ç¤ºã€æœç´¢ã€åˆ†ç±»ç­›é€‰
- `Login.vue` - ç™»å½•ï¼šç”¨æˆ·åå¯†ç ç™»å½•
- `Register.vue` - æ³¨å†Œï¼šç”¨æˆ·åã€å¯†ç ã€æ˜µç§°æ³¨å†Œ
- `Upload.vue` - ä¸Šä¼ ï¼šè§†é¢‘æ–‡ä»¶ã€å°é¢ã€æ ‡é¢˜ã€æè¿°ã€åˆ†ç±»é€‰æ‹©
- `VideoDetail.vue` - è¯¦æƒ…ï¼šè§†é¢‘æ’­æ”¾ã€è¯„è®ºåˆ—è¡¨ã€ç‚¹èµæ”¶è—
- `Profile.vue` - ä¸ªäººä¸­å¿ƒï¼šèµ„æ–™ä¿®æ”¹ã€æˆ‘çš„è§†é¢‘ã€æˆ‘çš„æ”¶è—
- `AdminAudit.vue` - å®¡æ ¸ï¼šå¾…å®¡æ ¸åˆ—è¡¨ã€å®¡æ ¸æ“ä½œ

---

## 4. æ•°æ®åº“æ¨¡å‹å…³ç³»

### 4.1 ERå…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User   â”‚â”€â”€â”€â”€â”€â”€â”€â”€<â”‚  Video  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 1    *  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                 â”‚ â”‚
     â”‚                 â”‚ â”‚
     â”‚ *          *    â”‚ â”‚ *
     â”‚                 â”‚ â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Comment â”‚       â”‚   Like   â”‚   â”‚ Collection â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚ â”‚
     â”‚ â”‚ (è‡ªå…³è”)
     â”‚ â”‚
  parent_id
   root_id

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Category  â”‚â”€â”€â”€â”€â”€â”€<â”‚  Video  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ 1   * â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 å¤–é”®å…³ç³»

| è¡¨å | å¤–é”®å­—æ®µ | å…³è”è¡¨ | çº§è”æ“ä½œ |
|------|----------|--------|----------|
| videos | user_id | users | CASCADE (åˆ é™¤ç”¨æˆ·æ—¶åˆ é™¤è§†é¢‘) |
| videos | category_id | categories | - |
| comments | user_id | users | CASCADE |
| comments | video_id | videos | CASCADE |
| comments | parent_id | comments (è‡ªå…³è”) | CASCADE |
| comments | root_id | comments (è‡ªå…³è”) | CASCADE |
| likes | user_id | users | CASCADE |
| likes | video_id | videos | CASCADE |
| collections | user_id | users | CASCADE |
| collections | video_id | videos | CASCADE |

### 4.3 å”¯ä¸€çº¦æŸ

- `likes`: (user_id, video_id) - é˜²æ­¢é‡å¤ç‚¹èµ
- `collections`: (user_id, video_id) - é˜²æ­¢é‡å¤æ”¶è—
- `users.username`: UNIQUE - ç”¨æˆ·åå”¯ä¸€
- `categories.name`: UNIQUE - åˆ†ç±»åå”¯ä¸€

---

## 5. APIè·¯ç”±ç»“æ„

### 5.1 APIç«¯ç‚¹æ€»è§ˆ

```
/api
â”œâ”€â”€ /auth                    # è®¤è¯æ¨¡å—
â”‚   â”œâ”€â”€ POST   /register     # æ³¨å†Œ
â”‚   â”œâ”€â”€ POST   /login        # ç™»å½•
â”‚   â””â”€â”€ GET    /me           # è·å–å½“å‰ç”¨æˆ·
â”‚
â”œâ”€â”€ /videos                  # è§†é¢‘æ¨¡å—
â”‚   â”œâ”€â”€ GET    /categories   # è·å–åˆ†ç±»
â”‚   â”œâ”€â”€ POST   /upload       # ä¸Šä¼ è§†é¢‘
â”‚   â”œâ”€â”€ GET    /list         # è§†é¢‘åˆ—è¡¨
â”‚   â””â”€â”€ GET    /<id>         # è§†é¢‘è¯¦æƒ…
â”‚
â”œâ”€â”€ /users                   # ç”¨æˆ·æ¨¡å—
â”‚   â””â”€â”€ /me
â”‚       â”œâ”€â”€ GET    /me              # è·å–ç”¨æˆ·ä¿¡æ¯
â”‚       â”œâ”€â”€ PUT    /me              # æ›´æ–°èµ„æ–™
â”‚       â”œâ”€â”€ GET    /me/videos       # æˆ‘çš„è§†é¢‘
â”‚       â””â”€â”€ GET    /me/collections  # æˆ‘çš„æ”¶è—
â”‚
â”œâ”€â”€ /admin                   # ç®¡ç†å‘˜æ¨¡å—
â”‚   â”œâ”€â”€ GET    /manage/list         # ç®¡ç†åˆ—è¡¨
â”‚   â”œâ”€â”€ GET    /audit/list          # å¾…å®¡æ ¸åˆ—è¡¨
â”‚   â”œâ”€â”€ POST   /audit/<video_id>    # å®¡æ ¸æ“ä½œ
â”‚   â””â”€â”€ DELETE /manage/video/<id>   # åˆ é™¤è§†é¢‘
â”‚
â””â”€â”€ /videos/<video_id>       # äº’åŠ¨æ¨¡å—
    â”œâ”€â”€ POST   /comments            # å‘è¡¨è¯„è®º
    â”œâ”€â”€ GET    /comments            # è·å–è¯„è®º
    â”œâ”€â”€ POST   /like                # ç‚¹èµ/å–æ¶ˆ
    â”œâ”€â”€ GET    /like/status         # ç‚¹èµçŠ¶æ€
    â”œâ”€â”€ POST   /collect             # æ”¶è—/å–æ¶ˆ
    â””â”€â”€ GET    /collect/status      # æ”¶è—çŠ¶æ€
```

### 5.2 ç»Ÿä¸€å“åº”æ ¼å¼

**æˆåŠŸå“åº”**ï¼š
```json
{
  "code": 200,
  "msg": "æ“ä½œæˆåŠŸ",
  "data": { ... }
}
```

**é”™è¯¯å“åº”**ï¼š
```json
{
  "code": 400/401/404/500,
  "msg": "é”™è¯¯ä¿¡æ¯",
  "data": null
}
```

**HTTPçŠ¶æ€ç **ï¼š
- 200 - æˆåŠŸ
- 201 - åˆ›å»ºæˆåŠŸ
- 400 - è¯·æ±‚å‚æ•°é”™è¯¯
- 401 - æœªæˆæƒ
- 404 - èµ„æºä¸å­˜åœ¨
- 409 - èµ„æºå†²çªï¼ˆå¦‚ç”¨æˆ·åå·²å­˜åœ¨ï¼‰
- 500 - æœåŠ¡å™¨é”™è¯¯

---

## 6. ä¸»è¦åŠŸèƒ½æ¨¡å—

### 6.1 ç”¨æˆ·è®¤è¯æ¨¡å—

**åŠŸèƒ½**ï¼š
- ç”¨æˆ·æ³¨å†Œï¼ˆç”¨æˆ·åã€å¯†ç ã€æ˜µç§°ï¼‰
- ç”¨æˆ·ç™»å½•ï¼ˆè¿”å›ç”¨æˆ·ä¿¡æ¯ï¼‰
- ç”¨æˆ·èº«ä»½è¯†åˆ«ï¼ˆé€šè¿‡è¯·æ±‚å¤´X-User-IDï¼‰

**æ•°æ®æµ**ï¼š
```
æ³¨å†Œï¼šå‰ç«¯ â†’ POST /api/auth/register â†’ åç«¯éªŒè¯ â†’ åˆ›å»ºç”¨æˆ· â†’ è¿”å›ç”¨æˆ·ID
ç™»å½•ï¼šå‰ç«¯ â†’ POST /api/auth/login â†’ åç«¯éªŒè¯ â†’ è¿”å›ç”¨æˆ·ä¿¡æ¯ â†’ å‰ç«¯å­˜å‚¨user_idåˆ°localStorage
```

### 6.2 è§†é¢‘ç®¡ç†æ¨¡å—

**åŠŸèƒ½**ï¼š
- è§†é¢‘ä¸Šä¼ ï¼ˆæ–‡ä»¶+å…ƒæ•°æ®ï¼‰
- è§†é¢‘åˆ—è¡¨ï¼ˆæœç´¢ã€åˆ†ç±»ç­›é€‰ï¼‰
- è§†é¢‘è¯¦æƒ…ï¼ˆæ’­æ”¾ã€ç»Ÿè®¡ï¼‰

**æ ¸å¿ƒé€»è¾‘**ï¼š
1. **ä¸Šä¼ æµç¨‹**ï¼š
   - æ¥æ”¶è§†é¢‘æ–‡ä»¶å’Œå°é¢å›¾ç‰‡
   - éªŒè¯æ–‡ä»¶æ ¼å¼å’Œå¤§å°
   - ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
   - ä¿å­˜æ–‡ä»¶åˆ°æœåŠ¡å™¨
   - æ ¹æ®ç”¨æˆ·è§’è‰²è®¾ç½®çŠ¶æ€ï¼ˆç®¡ç†å‘˜ç›´æ¥å‘å¸ƒï¼Œæ™®é€šç”¨æˆ·å¾…å®¡æ ¸ï¼‰
   - ä¿å­˜è®°å½•åˆ°æ•°æ®åº“

2. **åˆ—è¡¨æŸ¥è¯¢**ï¼š
   - ä»…è¿”å› status=1 (å·²å‘å¸ƒ) çš„è§†é¢‘
   - æ”¯æŒæŒ‰å…³é”®è¯æœç´¢ï¼ˆæ ‡é¢˜æ¨¡ç³ŠåŒ¹é…ï¼‰
   - æ”¯æŒæŒ‰åˆ†ç±»ç­›é€‰
   - æŒ‰åˆ›å»ºæ—¶é—´å€’åºæ’åˆ—

3. **è¯¦æƒ…æŸ¥è¯¢**ï¼š
   - æ¯æ¬¡è®¿é—® view_count+1
   - è¿”å›è§†é¢‘ä¿¡æ¯å’Œä½œè€…ä¿¡æ¯

### 6.3 å®¡æ ¸æ¨¡å—ï¼ˆç®¡ç†å‘˜ï¼‰

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹å¾…å®¡æ ¸è§†é¢‘åˆ—è¡¨
- å®¡æ ¸è§†é¢‘ï¼ˆé€šè¿‡/é©³å›ï¼‰
- ç®¡ç†è§†é¢‘ï¼ˆæŸ¥çœ‹æ‰€æœ‰ã€åˆ é™¤ï¼‰

**å®¡æ ¸çŠ¶æ€æµè½¬**ï¼š
```
ä¸Šä¼  â†’ status=0 (å¾…å®¡æ ¸) â†’ å®¡æ ¸é€šè¿‡ â†’ status=1 (å·²å‘å¸ƒ)
                     â†“ å®¡æ ¸é©³å›
                status=2 (å·²é©³å›)
```

### 6.4 äº’åŠ¨æ¨¡å—

**åŠŸèƒ½**ï¼š
- è¯„è®ºï¼ˆæ”¯æŒå¤šçº§å›å¤ï¼‰
- ç‚¹èµï¼ˆåˆ‡æ¢ï¼‰
- æ”¶è—ï¼ˆåˆ‡æ¢ï¼‰

**è¯„è®ºç»“æ„ï¼ˆå¤šçº§è¯„è®ºï¼‰**ï¼š
```
ä¸€çº§è¯„è®ºA (parent_id=None, root_id=None)
  â”œâ”€â”€ å›å¤A1 (parent_id=A.id, root_id=A.id)
  â”‚   â””â”€â”€ å›å¤A1-1 (parent_id=A1.id, root_id=A.id)
  â””â”€â”€ å›å¤A2 (parent_id=A.id, root_id=A.id)

ä¸€çº§è¯„è®ºB (parent_id=None, root_id=None)
  â””â”€â”€ å›å¤B1 (parent_id=B.id, root_id=B.id)
```

**ç‚¹èµ/æ”¶è—é€»è¾‘**ï¼š
- å¦‚æœå·²å­˜åœ¨è®°å½• â†’ åˆ é™¤è®°å½•ï¼ˆå–æ¶ˆï¼‰
- å¦‚æœä¸å­˜åœ¨è®°å½• â†’ åˆ›å»ºè®°å½•ï¼ˆæ·»åŠ ï¼‰

### 6.5 ä¸ªäººä¸­å¿ƒæ¨¡å—

**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹ä¸ªäººä¿¡æ¯
- ä¿®æ”¹èµ„æ–™ï¼ˆæ˜µç§°ã€å¯†ç ã€å¤´åƒï¼‰
- æŸ¥çœ‹æˆ‘çš„è§†é¢‘ï¼ˆæ‰€æœ‰çŠ¶æ€ï¼‰
- æŸ¥çœ‹æˆ‘çš„æ”¶è—ï¼ˆä»…å·²å‘å¸ƒï¼‰

---

## 7. æ•°æ®æµè½¬é€»è¾‘

### 7.1 ç”¨æˆ·æ³¨å†Œç™»å½•æµç¨‹

```
1. ç”¨æˆ·æ³¨å†Œ
   å‰ç«¯ â†’ POST /api/auth/register
   {username, password, nickname}
   â†“
   åç«¯éªŒè¯ â†’ åˆ›å»ºç”¨æˆ· â†’ å¯†ç åŠ å¯† â†’ ä¿å­˜æ•°æ®åº“
   â†“
   è¿”å› {code: 200, data: {id, username, nickname}}

2. ç”¨æˆ·ç™»å½•
   å‰ç«¯ â†’ POST /api/auth/login
   {username, password}
   â†“
   åç«¯éªŒè¯ â†’ æŸ¥è¯¢ç”¨æˆ· â†’ éªŒè¯å¯†ç 
   â†“
   è¿”å› {code: 200, data: {id, username, nickname, role, avatar}}
   â†“
   å‰ç«¯å­˜å‚¨ user_id åˆ° localStorage
```

### 7.2 è§†é¢‘ä¸Šä¼ å®¡æ ¸æµç¨‹

```
1. æ™®é€šç”¨æˆ·ä¸Šä¼ 
   å‰ç«¯ â†’ POST /api/videos/upload (FormData)
   {user_id, title, description, category_id, video_file, cover_file}
   â†“
   åç«¯éªŒè¯æ–‡ä»¶ â†’ ä¿å­˜æ–‡ä»¶ â†’ åˆ›å»ºVideoè®°å½• (status=0)
   â†“
   è¿”å› {code: 200, msg: "è§†é¢‘ä¸Šä¼ æˆåŠŸï¼Œç­‰å¾…ç®¡ç†å‘˜å®¡æ ¸"}

2. ç®¡ç†å‘˜ä¸Šä¼ 
   å‰ç«¯ â†’ POST /api/videos/upload
   â†“
   åç«¯åˆ¤æ–­ user.role == 'admin' â†’ åˆ›å»ºVideoè®°å½• (status=1)
   â†“
   è¿”å› {code: 200, msg: "è§†é¢‘ä¸Šä¼ æˆåŠŸï¼Œå·²ç›´æ¥å‘å¸ƒ"}

3. ç®¡ç†å‘˜å®¡æ ¸
   ç®¡ç†å‘˜ â†’ GET /api/admin/audit/list (æŸ¥çœ‹å¾…å®¡æ ¸åˆ—è¡¨)
   â†“
   ç®¡ç†å‘˜ â†’ POST /api/admin/audit/<video_id>
   {action: "approve" | "reject"}
   â†“
   åç«¯æ›´æ–° video.status = 1 (é€šè¿‡) æˆ– 2 (é©³å›)
```

### 7.3 è§†é¢‘æµè§ˆäº’åŠ¨æµç¨‹

```
1. è§†é¢‘åˆ—è¡¨
   å‰ç«¯ â†’ GET /api/videos/list?keyword=xxx&category_id=1
   â†“
   åç«¯æŸ¥è¯¢ status=1 çš„è§†é¢‘ â†’ è¿‡æ»¤æœç´¢/åˆ†ç±» â†’ è¿”å›åˆ—è¡¨

2. è§†é¢‘è¯¦æƒ…
   å‰ç«¯ â†’ GET /api/videos/<id>
   â†“
   åç«¯æŸ¥è¯¢è§†é¢‘ â†’ view_count+1 â†’ è¿”å›è¯¦æƒ…

3. è¯„è®º
   å‰ç«¯ â†’ POST /api/videos/<video_id>/comments
   {user_id, content, parent_id?}
   â†“
   åç«¯è®¡ç®—root_id â†’ åˆ›å»ºCommentè®°å½• â†’ è¿”å›è¯„è®º

4. ç‚¹èµ/æ”¶è—
   å‰ç«¯ â†’ POST /api/videos/<video_id>/like (æˆ– /collect)
   {user_id}
   â†“
   åç«¯æ£€æŸ¥æ˜¯å¦å­˜åœ¨ â†’ åˆ‡æ¢çŠ¶æ€ â†’ è¿”å›å½“å‰çŠ¶æ€å’Œæ€»æ•°
```

### 7.4 æ–‡ä»¶å­˜å‚¨é€»è¾‘

```
ä¸Šä¼ æ–‡ä»¶
â†“
ç”Ÿæˆæ–‡ä»¶å: {timestamp}_{uuid}.{ext}
ä¾‹å¦‚: 20260104003424_8a771008.mp4
â†“
ä¿å­˜è·¯å¾„:
- è§†é¢‘: backend/static/videos/{filename}
- å°é¢: backend/static/covers/{filename}
- å¤´åƒ: backend/static/avatars/{filename}
â†“
æ•°æ®åº“å­˜å‚¨ç›¸å¯¹è·¯å¾„:
- video_path: "videos/{filename}"
- cover_path: "covers/{filename}"
- avatar: "/static/avatars/{filename}"
â†“
è®¿é—®URL:
http://localhost:5001/static/{ç›¸å¯¹è·¯å¾„}
```

---

## 8. å…³é”®è®¾è®¡è¦ç‚¹

### 8.1 è§†é¢‘å®¡æ ¸æœºåˆ¶ï¼ˆå…ˆå®¡åå‘ï¼‰

- **çŠ¶æ€å­—æ®µ**ï¼š`Video.status` (0=å¾…å®¡æ ¸, 1=å·²å‘å¸ƒ, 2=å·²é©³å›)
- **ä¸Šä¼ é€»è¾‘**ï¼šæ™®é€šç”¨æˆ·ä¸Šä¼ å status=0ï¼Œç®¡ç†å‘˜ä¸Šä¼ å status=1
- **åˆ—è¡¨æŸ¥è¯¢**ï¼šä»…è¿”å› status=1 çš„è§†é¢‘
- **å®¡æ ¸æ“ä½œ**ï¼šç®¡ç†å‘˜å¯é€šè¿‡APIå°† status=0 æ”¹ä¸º 1 æˆ– 2

### 8.2 å¤šçº§è¯„è®ºè®¾è®¡

- **parent_id**ï¼šç›´æ¥çˆ¶è¯„è®ºIDï¼ˆç”¨äºæ„å»ºè¯„è®ºæ ‘ï¼‰
- **root_id**ï¼šæ ¹è¯„è®ºIDï¼ˆç”¨äºå¿«é€ŸèšåˆåŒä¸€æ¥¼å±‚çš„æ‰€æœ‰å›å¤ï¼‰
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šé€šè¿‡ç´¢å¼• `idx_video_root` ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

### 8.3 è®¤è¯æœºåˆ¶ï¼ˆç®€åŒ–ç‰ˆï¼‰

- **ä¸ä½¿ç”¨JWT**ï¼šé€šè¿‡è¯·æ±‚å¤´ `X-User-ID` ä¼ é€’ç”¨æˆ·ID
- **å‰ç«¯å­˜å‚¨**ï¼šlocalStorage å­˜å‚¨ user_id
- **å¯å‡çº§**ï¼šåç»­å¯å‡çº§ä¸ºJWT Tokenè®¤è¯

### 8.4 æ–‡ä»¶ç®¡ç†

- **å­˜å‚¨æ–¹å¼**ï¼šæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ
- **æ–‡ä»¶å‘½å**ï¼šæ—¶é—´æˆ³+UUIDï¼Œé¿å…å†²çª
- **è·¯å¾„ç®¡ç†**ï¼šæ•°æ®åº“å­˜å‚¨ç›¸å¯¹è·¯å¾„ï¼Œè®¿é—®æ—¶æ‹¼æ¥å®Œæ•´URL

---

## 9. ä»£ç ç´¢å¼•é€ŸæŸ¥

### 9.1 åç«¯å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½ | å…³é”®å†…å®¹ |
|----------|------|----------|
| `backend/app.py` | åº”ç”¨å…¥å£ | `create_app()`, è“å›¾æ³¨å†Œ |
| `backend/config.py` | é…ç½®ç®¡ç† | ç¯å¢ƒé…ç½®ã€æ•°æ®åº“URIã€ä¸Šä¼ é…ç½® |
| `backend/models.py` | æ•°æ®æ¨¡å‹ | 6ä¸ªæ¨¡å‹ç±»ã€å…³ç³»å®šä¹‰ã€çŠ¶æ€å¸¸é‡ |
| `backend/routes/auth.py` | è®¤è¯è·¯ç”± | æ³¨å†Œã€ç™»å½•ã€è·å–å½“å‰ç”¨æˆ· |
| `backend/routes/video.py` | è§†é¢‘è·¯ç”± | ä¸Šä¼ ã€åˆ—è¡¨ã€è¯¦æƒ…ã€åˆ†ç±» |
| `backend/routes/user.py` | ç”¨æˆ·è·¯ç”± | ä¸ªäººä¸­å¿ƒã€èµ„æ–™ä¿®æ”¹ã€æˆ‘çš„è§†é¢‘/æ”¶è— |
| `backend/routes/admin.py` | ç®¡ç†å‘˜è·¯ç”± | å®¡æ ¸ã€ç®¡ç†ã€åˆ é™¤ |
| `backend/routes/interaction.py` | äº’åŠ¨è·¯ç”± | è¯„è®ºã€ç‚¹èµã€æ”¶è— |

### 9.2 å‰ç«¯å…³é”®æ–‡ä»¶ç´¢å¼•

| æ–‡ä»¶è·¯å¾„ | åŠŸèƒ½ | å…³é”®å†…å®¹ |
|----------|------|----------|
| `frontend/src/main.js` | åº”ç”¨å…¥å£ | Vueå®ä¾‹åˆ›å»ºã€è·¯ç”±æ³¨å†Œ |
| `frontend/src/App.vue` | æ ¹ç»„ä»¶ | è·¯ç”±è§†å›¾å®¹å™¨ |
| `frontend/src/api.js` | APIé…ç½® | Axioså®ä¾‹ã€è¯·æ±‚æ‹¦æˆªå™¨ |
| `frontend/src/router/index.js` | è·¯ç”±é…ç½® | è·¯ç”±å®šä¹‰ã€è·¯å¾„æ˜ å°„ |
| `frontend/src/views/Home.vue` | é¦–é¡µ | è§†é¢‘åˆ—è¡¨å±•ç¤º |
| `frontend/src/views/VideoDetail.vue` | è¯¦æƒ…é¡µ | è§†é¢‘æ’­æ”¾ã€è¯„è®ºã€äº’åŠ¨ |
| `frontend/src/views/Upload.vue` | ä¸Šä¼ é¡µ | æ–‡ä»¶ä¸Šä¼ ã€è¡¨å•æäº¤ |
| `frontend/src/views/AdminAudit.vue` | å®¡æ ¸é¡µ | å®¡æ ¸åˆ—è¡¨ã€å®¡æ ¸æ“ä½œ |
| `frontend/src/views/Profile.vue` | ä¸ªäººä¸­å¿ƒ | èµ„æ–™ç®¡ç†ã€æˆ‘çš„è§†é¢‘/æ”¶è— |

### 9.3 æ•°æ®åº“æ¨¡å‹ç´¢å¼•

| æ¨¡å‹ç±» | æ–‡ä»¶ä½ç½® | æ ¸å¿ƒå­—æ®µ | æ ¸å¿ƒå…³ç³» |
|--------|----------|----------|----------|
| `User` | `models.py:14` | username, password, role | videos, comments, likes, collections |
| `Category` | `models.py:85` | name | videos |
| `Video` | `models.py:113` | title, status, view_count | author, category, comments, likes |
| `Comment` | `models.py:200` | content, parent_id, root_id | parent, children, root |
| `Like` | `models.py:273` | user_id, video_id | user, video |
| `Collection` | `models.py:309` | user_id, video_id | user, video |

---

## 10. å¼€å‘æ³¨æ„äº‹é¡¹

### 10.1 ä»£ç è§„èŒƒ

- **æ³¨é‡Š**ï¼šæ‰€æœ‰å‡½æ•°å’Œç±»éƒ½åº”æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²è¯´æ˜
- **é”™è¯¯å¤„ç†**ï¼šæ‰€æœ‰è·¯ç”±éƒ½åº”åŒ…å« try-except é”™è¯¯å¤„ç†
- **äº‹åŠ¡ç®¡ç†**ï¼šæ•°æ®åº“æ“ä½œå¤±è´¥æ—¶åº”å›æ»šï¼ˆ`db.session.rollback()`ï¼‰
- **å“åº”æ ¼å¼**ï¼šç»Ÿä¸€ä½¿ç”¨ `{code, msg, data}` æ ¼å¼

### 10.2 å®‰å…¨æ³¨æ„äº‹é¡¹

- **å¯†ç å­˜å‚¨**ï¼šä½¿ç”¨ `werkzeug.security.generate_password_hash()` åŠ å¯†
- **æ–‡ä»¶éªŒè¯**ï¼šä¸Šä¼ æ–‡ä»¶åº”éªŒè¯æ ¼å¼å’Œå¤§å°
- **SQLæ³¨å…¥**ï¼šä½¿ç”¨ORMï¼ˆSQLAlchemyï¼‰é¿å…SQLæ³¨å…¥
- **XSSé˜²æŠ¤**ï¼šå‰ç«¯åº”å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè½¬ä¹‰

### 10.3 æ€§èƒ½ä¼˜åŒ–

- **æ•°æ®åº“ç´¢å¼•**ï¼šstatusã€created_atç­‰å¸¸ç”¨æŸ¥è¯¢å­—æ®µå·²å»ºç«‹ç´¢å¼•
- **æŸ¥è¯¢ä¼˜åŒ–**ï¼šä½¿ç”¨ `lazy='dynamic'` å»¶è¿ŸåŠ è½½å…³ç³»æ•°æ®
- **æ–‡ä»¶å­˜å‚¨**ï¼šè€ƒè™‘åç»­å‡çº§ä¸ºå¯¹è±¡å­˜å‚¨ï¼ˆOSSï¼‰

---

## 11. æ‰©å±•å»ºè®®

### 11.1 è®¤è¯å‡çº§
- å¼•å…¥JWT Tokenè®¤è¯
- æ·»åŠ Tokenåˆ·æ–°æœºåˆ¶
- å®ç°æƒé™ä¸­é—´ä»¶

### 11.2 æ–‡ä»¶å­˜å‚¨å‡çº§
- è¿ç§»åˆ°å¯¹è±¡å­˜å‚¨æœåŠ¡ï¼ˆOSS/S3ï¼‰
- æ”¯æŒCDNåŠ é€Ÿ
- å®ç°è§†é¢‘è½¬ç ï¼ˆå¤šåˆ†è¾¨ç‡ï¼‰

### 11.3 åŠŸèƒ½å¢å¼º
- è§†é¢‘æœç´¢ä¼˜åŒ–ï¼ˆå…¨æ–‡æ£€ç´¢ï¼‰
- ç”¨æˆ·å…³æ³¨åŠŸèƒ½
- ç§ä¿¡åŠŸèƒ½
- è§†é¢‘æ¨èç®—æ³•

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**æœ€åæ›´æ–°**ï¼š2025-01-04  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ
