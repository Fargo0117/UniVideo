# 快速入门

<cite>
**本文引用的文件**
- [backend/.env.example](file://backend/.env.example)
- [backend/requirements.txt](file://backend/requirements.txt)
- [backend/app.py](file://backend/app.py)
- [backend/config.py](file://backend/config.py)
- [backend/init_db.py](file://backend/init_db.py)
- [univideo_db.sql](file://univideo_db.sql)
- [frontend/package.json](file://frontend/package.json)
- [frontend/vite.config.js](file://frontend/vite.config.js)
- [frontend/src/api.js](file://frontend/src/api.js)
</cite>

## 目录
1. [简介](#简介)
2. [项目结构](#项目结构)
3. [核心组件](#核心组件)
4. [架构总览](#架构总览)
5. [详细组件分析](#详细组件分析)
6. [依赖分析](#依赖分析)
7. [性能考虑](#性能考虑)
8. [故障排查指南](#故障排查指南)
9. [结论](#结论)
10. [附录](#附录)

## 简介
本指南面向首次接触 UniVideo 的开发者，帮助你在本地 30 分钟内完成前后端环境搭建、数据库初始化与服务器启动，并通过端到端示例验证环境可用性。你将学会：
- 安装后端依赖（pip）与前端依赖（npm）
- 初始化 MySQL 数据库并导入表结构
- 配置环境变量（基于 .env.example）
- 启动后端 Flask 服务（http://localhost:5001）与前端 Vite 开发服务器（http://localhost:3000）
- 常见问题排查（端口冲突、数据库连接失败）

## 项目结构
UniVideo 采用前后端分离架构：
- 后端（Python Flask）：提供 RESTful API，负责认证、视频管理、互动、管理员功能等
- 前端（Vue 3 + Vite）：提供用户界面与交互，通过 axios 调用后端 API
- 数据库：MySQL（使用 PyMySQL 驱动与 SQLAlchemy ORM）

```mermaid
graph TB
subgraph "前端"
FE_API["前端 axios 实例<br/>指向后端 API 基础地址"]
FE_Vite["Vite 开发服务器<br/>端口 3000"]
end
subgraph "后端"
BE_App["Flask 应用<br/>端口 5001"]
BE_Config["配置加载<br/>环境变量/数据库 URI"]
BE_DB["MySQL 数据库"]
end
FE_Vite --> FE_API
FE_API --> BE_App
BE_App --> BE_Config
BE_Config --> BE_DB
```

图表来源
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [frontend/vite.config.js](file://frontend/vite.config.js#L1-L19)
- [backend/app.py](file://backend/app.py#L94-L101)
- [backend/config.py](file://backend/config.py#L26-L30)

章节来源
- [backend/app.py](file://backend/app.py#L1-L101)
- [backend/config.py](file://backend/config.py#L1-L66)
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [frontend/vite.config.js](file://frontend/vite.config.js#L1-L19)

## 核心组件
- 后端 Flask 应用：创建应用、注册蓝图、健康检查、开发服务器启动
- 配置模块：加载环境变量、设置数据库 URI、上传目录与文件类型限制
- 前端 axios 实例：统一配置后端 API 基础地址、请求拦截器（透传用户 ID）
- Vite 配置：插件与别名、开发服务器端口
- 数据库初始化脚本：示例数据初始化（需先导入表结构）

章节来源
- [backend/app.py](file://backend/app.py#L1-L101)
- [backend/config.py](file://backend/config.py#L1-L66)
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [frontend/vite.config.js](file://frontend/vite.config.js#L1-L19)
- [backend/init_db.py](file://backend/init_db.py#L1-L99)

## 架构总览
后端通过 Flask 提供 API，前端通过 axios 调用后端接口。开发时，前端 Vite 服务器监听 3000 端口，后端 Flask 监听 5001 端口。健康检查接口可用于确认后端与数据库连通性。

```mermaid
sequenceDiagram
participant Dev as "开发者"
participant FE as "前端 Vite (3000)"
participant AX as "axios 实例"
participant BE as "Flask 应用 (5001)"
Dev->>FE : 启动前端开发服务器
FE->>AX : 发起 API 请求
AX->>BE : 调用 /api/health 或业务接口
BE-->>AX : 返回响应
AX-->>FE : 前端渲染结果
```

图表来源
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [backend/app.py](file://backend/app.py#L73-L92)

章节来源
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [backend/app.py](file://backend/app.py#L73-L92)

## 详细组件分析

### 后端 Flask 应用与启动
- 应用工厂：创建 Flask 实例、加载配置、初始化数据库与迁移、CORS、注册蓝图
- 健康检查：测试数据库连通性，返回服务状态
- 开发服务器：绑定 0.0.0.0:5001，开启调试模式

章节来源
- [backend/app.py](file://backend/app.py#L1-L101)

### 配置与环境变量
- 环境变量示例：包含 Flask 应用、数据库、JWT、文件上传、服务器主机与端口
- 数据库 URI：默认使用 MySQL，格式为 mysql+pymysql://user:password@host/dbname
- 上传目录：使用绝对路径指向后端 static 目录，包含 videos、covers、avatars 子目录

章节来源
- [backend/.env.example](file://backend/.env.example#L1-L21)
- [backend/config.py](file://backend/config.py#L1-L66)

### 前端 axios 与 Vite
- axios 基础地址：http://localhost:5001/api
- 请求拦截器：从 localStorage 读取 user_id 并透传到后端 X-User-ID 请求头
- Vite 开发服务器：默认端口 3000，使用 @vitejs/plugin-vue 与别名 @ 指向 src

章节来源
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [frontend/vite.config.js](file://frontend/vite.config.js#L1-L19)
- [frontend/package.json](file://frontend/package.json#L1-L25)

### 数据库初始化与示例数据
- 表结构：univideo_db.sql 定义用户、视频、分类、评论、点赞、收藏等表
- 示例数据：init_db.py 在已有表结构基础上插入默认分类与测试账号（普通用户与管理员）

章节来源
- [univideo_db.sql](file://univideo_db.sql#L50-L76)
- [backend/init_db.py](file://backend/init_db.py#L1-L99)

## 依赖分析
- 后端依赖：Flask、Flask-CORS、Flask-SQLAlchemy、PyMySQL、Flask-Migrate、Flask-JWT-Extended、bcrypt、python-dotenv、Flask-WTF、requests、Pillow 等
- 前端依赖：Vue 3、Vue Router、Axios、Vite、@vitejs/plugin-vue、vite-plugin-vue-devtools
- Node 版本要求：package.json 中 engines 指定 Node 版本范围

章节来源
- [backend/requirements.txt](file://backend/requirements.txt#L1-L45)
- [frontend/package.json](file://frontend/package.json#L1-L25)

## 性能考虑
- 健康检查：后端提供 /api/health 用于快速验证数据库连通性
- 上传目录：后端在启动时确保 static 下的 videos、covers、avatars 目录存在
- 前端请求拦截器：透传用户 ID，减少后端重复鉴权开销
- 数据库连接：使用 MySQL 驱动与 SQLAlchemy ORM，建议在生产环境配置连接池与索引优化

章节来源
- [backend/app.py](file://backend/app.py#L73-L92)
- [backend/config.py](file://backend/config.py#L1-L66)
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)

## 故障排查指南
- 端口冲突
  - 后端默认端口：5001
  - 前端默认端口：3000
  - 如冲突，请在启动前修改对应配置或释放占用端口
- 数据库连接失败
  - 确认 MySQL 服务已启动
  - 检查 DATABASE_URL 是否正确（用户名、密码、主机、数据库名）
  - 先执行 univideo_db.sql 创建数据库与表结构，再运行后端
- 健康检查失败
  - 访问 http://localhost:5001/api/health，查看数据库状态
  - 若报错，检查数据库连接字符串与网络连通性
- 前端无法访问后端
  - 确认 axios 基础地址 http://localhost:5001/api 正确
  - 确认后端已启动并监听 0.0.0.0:5001
- 示例数据未生效
  - 确保已先导入表结构，再运行示例数据初始化脚本

章节来源
- [backend/app.py](file://backend/app.py#L73-L92)
- [backend/config.py](file://backend/config.py#L26-L30)
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- [backend/init_db.py](file://backend/init_db.py#L1-L99)

## 结论
按照本指南的步骤，你可以在本地快速搭建 UniVideo 的前后端开发环境，并通过健康检查与端到端示例验证系统可用性。建议在完成基础环境后，进一步阅读后端蓝图与前端路由，逐步熟悉认证、视频管理与互动模块的实现。

## 附录

### 环境准备与命令行步骤
以下为可直接复制使用的命令行序列（按顺序执行）：

- 安装后端依赖（Python 环境已就绪）
  - 进入后端目录并安装依赖
  - 命令参考路径：[backend/requirements.txt](file://backend/requirements.txt#L1-L45)

- 初始化数据库
  - 使用 MySQL 客户端导入表结构
  - 命令参考路径：[univideo_db.sql](file://univideo_db.sql#L50-L76)

- 配置环境变量（基于 .env.example）
  - 复制 .env.example 为 .env
  - 设置 FLASK_APP、FLASK_ENV、SECRET_KEY、DATABASE_URL、JWT_SECRET_KEY、HOST、PORT 等
  - 命令参考路径：[backend/.env.example](file://backend/.env.example#L1-L21)

- 启动后端 Flask 服务
  - 后端默认监听 0.0.0.0:5001，调试模式启动
  - 命令参考路径：[backend/app.py](file://backend/app.py#L94-L101)

- 安装前端依赖（Node 环境已就绪）
  - 进入前端目录并安装依赖
  - 命令参考路径：[frontend/package.json](file://frontend/package.json#L1-L25)

- 启动前端 Vite 开发服务器
  - 默认监听 3000 端口
  - 命令参考路径：[frontend/vite.config.js](file://frontend/vite.config.js#L1-L19)

- 验证健康检查
  - 访问 http://localhost:5001/api/health
  - 命令参考路径：[backend/app.py](file://backend/app.py#L73-L92)

### 端到端示例（注册→登录→上传视频→查看视频）
- 注册与登录
  - 使用前端注册页面创建账户，随后登录
  - 命令参考路径：[frontend/src/api.js](file://frontend/src/api.js#L1-L41)
- 上传视频
  - 登录后进入上传页面，提交视频文件
  - 后端根据用户角色决定审核状态（管理员免审）
  - 命令参考路径：[backend/app.py](file://backend/app.py#L1-L101)
- 查看视频
  - 在首页或视频详情页查看已发布视频
  - 命令参考路径：[frontend/src/api.js](file://frontend/src/api.js#L1-L41)