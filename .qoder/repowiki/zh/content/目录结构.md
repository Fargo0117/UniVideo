# 目录结构

<cite>
**本文档引用的文件**  
- [app.py](file://backend/app.py)
- [config.py](file://backend/config.py)
- [models.py](file://backend/models.py)
- [init_db.py](file://backend/init_db.py)
- [routes/auth.py](file://backend/routes/auth.py)
- [routes/user.py](file://backend/routes/user.py)
- [routes/video.py](file://backend/routes/video.py)
- [routes/admin.py](file://backend/routes/admin.py)
- [routes/interaction.py](file://backend/routes/interaction.py)
- [main.js](file://frontend/src/main.js)
- [App.vue](file://frontend/src/App.vue)
- [router/index.js](file://frontend/src/router/index.js)
- [api.js](file://frontend/src/api.js)
- [package.json](file://frontend/package.json)
- [vite.config.js](file://frontend/vite.config.js)
- [univideo_db.sql](file://univideo_db.sql)
- [文档/需求分析规格说明书.md](file://文档/需求分析规格说明书.md)
- [文档/软件设计说明书.md](file://文档/软件设计说明书.md)
- [文档/可行性分析与开发计划.md](file://文档/可行性分析与开发计划.md)
- [文档/课程设计总结报告.md](file://文档/课程设计总结报告.md)
</cite>

## 目录结构

UniVideo项目采用前后端分离的架构设计，整体目录结构清晰，职责分明。项目根目录下包含`backend/`（后端Flask应用）、`frontend/`（前端Vue应用）、`文档/`（项目设计文档）以及数据库脚本`univideo_db.sql`。

```mermaid
graph TD
A[UniVideo项目根目录] --> B[backend/]
A --> C[frontend/]
A --> D[文档/]
A --> E[univideo_db.sql]
B --> B1[routes/]
B --> B2[static/]
B --> B3[app.py]
B --> B4[config.py]
B --> B5[models.py]
B --> B6[init_db.py]
C --> C1[src/]
C --> C2[vite.config.js]
C --> C3[package.json]
C1 --> C11[views/]
C1 --> C12[router/]
C1 --> C13[assets/]
C1 --> C14[App.vue]
C1 --> C15[main.js]
C1 --> C16[api.js]
D --> D1[需求分析规格说明书.md]
D --> D2[软件设计说明书.md]
D --> D3[可行性分析与开发计划.md]
D --> D4[课程设计总结报告.md]
style A fill:#f9f,stroke:#333
style B fill:#bbf,stroke:#333,color:#fff
style C fill:#bbf,stroke:#333,color:#fff
style D fill:#f96,stroke:#333,color:#fff
style E fill:#6f9,stroke:#333,color:#fff
```

**Diagram sources**
- [backend/app.py](file://backend/app.py#L1-L101)
- [frontend/src/main.js](file://frontend/src/main.js#L1-L12)
- [文档/需求分析规格说明书.md](file://文档/需求分析规格说明书.md)

## 后端Flask应用模块划分

后端位于`backend/`目录，采用Flask框架构建RESTful API服务，遵循模块化设计原则。

### 核心模块

- **app.py**: 应用主入口文件，使用应用工厂模式创建Flask实例，负责加载配置、初始化数据库扩展（SQLAlchemy、Flask-Migrate）、注册所有蓝图（Blueprints）并定义根路由和健康检查接口。
- **config.py**: 配置管理文件，定义了`DevelopmentConfig`、`TestingConfig`和`ProductionConfig`三个环境的配置类，包含数据库连接、密钥、文件上传路径等关键设置。
- **models.py**: 数据库模型定义文件，使用SQLAlchemy ORM定义了`User`、`Video`、`Comment`、`Like`、`Collection`和`Category`等核心数据模型，严格对应数据库表结构。
- **init_db.py**: 数据库初始化脚本，用于向数据库插入示例数据（如默认分类、测试用户和管理员账号），方便开发和测试。

**Section sources**
- [backend/app.py](file://backend/app.py#L1-L101)
- [backend/config.py](file://backend/config.py#L1-L66)
- [backend/models.py](file://backend/models.py#L1-L343)
- [backend/init_db.py](file://backend/init_db.py#L1-L99)

### 路由模块 (routes/)

`routes/`目录下的每个Python文件定义了一个功能模块的API路由，通过Flask蓝图（Blueprint）进行组织和注册。

- **auth.py**: 认证路由，提供`/api/auth/register`（注册）、`/api/auth/login`（登录）和`/api/auth/me`（获取当前用户）等接口。
- **user.py**: 用户个人中心路由，提供`/api/users/me`（获取/更新用户资料）、`/api/users/me/videos`（我的视频列表）和`/api/users/me/collections`（我的收藏列表）等接口。
- **video.py**: 视频核心路由，提供`/api/videos/upload`（视频上传）、`/api/videos/list`（视频列表）、`/api/videos/categories`（分类列表）和`/api/videos/<id>`（视频详情）等接口。
- **admin.py**: 管理员路由，提供`/api/admin/manage/list`（管理列表）、`/api/admin/audit/list`（待审核列表）和`/api/admin/audit/<id>`（审核操作）等接口。
- **interaction.py**: 互动路由，提供`/api/videos/<id>/comments`（评论）、`/api/videos/<id>/like`（点赞）和`/api/videos/<id>/collect`（收藏）等接口。

```mermaid
graph TD
A[app.py] --> |注册| B[auth_bp]
A --> |注册| C[user_bp]
A --> |注册| D[video_bp]
A --> |注册| E[admin_bp]
A --> |注册| F[interaction_bp]
B --> G[auth.py]
C --> H[user.py]
D --> I[video.py]
E --> J[admin.py]
F --> K[interaction.py]
style A fill:#bbf,stroke:#333,color:#fff
style G fill:#cfc,stroke:#333
style H fill:#cfc,stroke:#333
style I fill:#cfc,stroke:#333
style J fill:#cfc,stroke:#333
style K fill:#cfc,stroke:#333
```

**Diagram sources**
- [backend/app.py](file://backend/app.py#L39-L57)
- [backend/routes/auth.py](file://backend/routes/auth.py#L1-L184)
- [backend/routes/user.py](file://backend/routes/user.py#L1-L271)
- [backend/routes/video.py](file://backend/routes/video.py#L1-L282)
- [backend/routes/admin.py](file://backend/routes/admin.py#L1-L245)
- [backend/routes/interaction.py](file://backend/routes/interaction.py#L1-L408)

### 静态资源与配置

- **static/**: 静态文件目录，用于存放用户上传的视频文件、封面图片和头像。后端在启动时会自动创建`videos/`、`covers/`和`avatars/`子目录。
- **.env.example**: 环境变量示例文件，提示开发者需要设置`SECRET_KEY`和`DATABASE_URL`等环境变量。
- **requirements.txt**: Python依赖包列表，定义了项目所需的所有第三方库。

**Section sources**
- [backend/app.py](file://backend/app.py#L33-L38)
- [backend/config.py](file://backend/config.py#L19-L24)

## 前端Vue项目组件化结构

前端位于`frontend/`目录，基于Vue 3和Vite构建，采用组件化开发模式。

### 核心入口与配置

- **main.js**: 应用的主入口文件，负责创建Vue应用实例，引入并使用`router`。
- **App.vue**: 根组件，使用`<RouterView />`作为路由视图的占位符，实现页面的动态切换。
- **vite.config.js**: Vite构建工具的配置文件，定义了Vue插件和路径别名（`@`指向`src/`目录）。
- **package.json**: 项目元数据和依赖管理文件，声明了`vue`、`vue-router`和`axios`等核心依赖。

**Section sources**
- [frontend/src/main.js](file://frontend/src/main.js#L1-L12)
- [frontend/src/App.vue](file://frontend/src/App.vue#L1-L13)
- [frontend/vite.config.js](file://frontend/vite.config.js#L1-L19)
- [frontend/package.json](file://frontend/package.json#L1-L25)

### 组件化结构 (src/)

`src/`目录是前端源码的核心。

- **views/**: 视图组件目录，每个`.vue`文件代表一个独立的页面。
  - `Home.vue`: 首页，展示视频列表。
  - `Login.vue` / `Register.vue`: 登录和注册页面。
  - `Upload.vue`: 视频上传页面。
  - `VideoDetail.vue`: 视频详情页面。
  - `Profile.vue`: 用户个人主页。
  - `AdminAudit.vue`: 管理员审核后台。
- **router/index.js**: 路由配置文件，定义了从URL路径到视图组件的映射关系，如`/`映射到`Home.vue`，`/video/:id`映射到`VideoDetail.vue`。
- **assets/**: 静态资源目录，存放CSS样式文件（`base.css`, `main.css`）。
- **api.js**: API配置文件，使用`axios`创建了一个预配置的HTTP客户端实例，统一设置后端API的基础URL（`http://localhost:5001/api`）和请求拦截器（用于自动添加用户ID到请求头）。

```mermaid
graph TD
A[main.js] --> |创建| B[Vue App]
B --> |挂载| C[App.vue]
C --> |渲染| D[RouterView]
D --> |加载| E[views/]
F[router/index.js] --> |配置| D
G[api.js] --> |提供| H[HTTP Client]
E --> I[Home.vue]
E --> J[Login.vue]
E --> K[Register.vue]
E --> L[Upload.vue]
E --> M[VideoDetail.vue]
E --> N[Profile.vue]
E --> O[AdminAudit.vue]
style A fill:#cfc,stroke:#333
style B fill:#bbf,stroke:#333,color:#fff
style C fill:#cfc,stroke:#333
style D fill:#cfc,stroke:#333
style E fill:#cfc,stroke:#333
style F fill:#cfc,stroke:#333
style G fill:#cfc,stroke:#333
```

**Diagram sources**
- [frontend/src/main.js](file://frontend/src/main.js#L1-L12)
- [frontend/src/App.vue](file://frontend/src/App.vue#L1-L13)
- [frontend/src/router/index.js](file://frontend/src/router/index.js#L1-L56)
- [frontend/src/api.js](file://frontend/src/api.js#L1-L41)

## 文档目录

`文档/`目录存放了项目开发过程中的各类设计文档，是理解项目背景和设计思路的重要资料。

- **需求分析规格说明书.md**: 详细阐述了系统的功能需求和非功能需求，定义了用户角色和核心业务流程。
- **软件设计说明书.md**: 描述了系统的总体架构、模块划分、数据库设计（ER图）和接口设计。
- **可行性分析与开发计划.md**: 论证了项目的技术、经济和操作可行性，并制定了详细的开发时间表。
- **课程设计总结报告.md**: 项目完成后的总结性文档，回顾了开发过程、遇到的问题和最终成果。

**Section sources**
- [文档/需求分析规格说明书.md](file://文档/需求分析规格说明书.md)
- [文档/软件设计说明书.md](file://文档/软件设计说明书.md)
- [文档/可行性分析与开发计划.md](file://文档/可行性分析与开发计划.md)
- [文档/课程设计总结报告.md](file://文档/课程设计总结报告.md)

## 静态资源与数据库

### 静态资源存放路径

静态资源的存放和访问路径有明确的规范：
- **后端上传**: 用户上传的视频、封面和头像文件由后端Flask应用保存在`backend/static/`目录下的`videos/`、`covers/`和`avatars/`子目录中。
- **前端访问**: 前端通过`http://localhost:5001/static/`前缀来访问这些静态资源。例如，一个视频文件的完整URL为`http://localhost:5001/static/videos/20231001_abc123.mp4`。

### 数据库脚本与配置

- **univideo_db.sql**: SQL脚本文件，包含了创建`univideo_db`数据库以及所有数据表（如`users`, `videos`, `comments`等）的DDL语句。开发者需要先执行此脚本以初始化数据库结构。
- **数据库连接**: 数据库连接信息在`backend/config.py`中配置，默认使用MySQL，连接URI为`mysql+pymysql://root:lzh20050117@localhost/univideo_db`，可通过环境变量`DATABASE_URL`覆盖。

**Section sources**
- [backend/config.py](file://backend/config.py#L28-L29)
- [backend/models.py](file://backend/models.py#L6-L8)
- [univideo_db.sql](file://univideo_db.sql)

## 新增功能与修改规范

### 新增后端功能

1.  **创建新路由文件**: 在`backend/routes/`目录下创建新的Python文件（如`new_feature.py`）。
2.  **定义蓝图和接口**: 在新文件中创建蓝图（`new_feature_bp = Blueprint('new_feature', __name__)`）并定义API路由。
3.  **注册蓝图**: 在`backend/app.py`的`create_app`函数中，导入新蓝图并使用`app.register_blueprint()`进行注册。
4.  **定义模型（如需要）**: 如果新功能需要新的数据表，应在`backend/models.py`中定义相应的SQLAlchemy模型类。

### 新增前端功能

1.  **创建新视图组件**: 在`frontend/src/views/`目录下创建新的`.vue`文件（如`NewFeature.vue`）。
2.  **配置路由**: 在`frontend/src/router/index.js`的`routes`数组中添加新的路由配置，将路径映射到新创建的组件。
3.  **编写API调用**: 在新组件中，通过导入`api.js`中的`api`实例来调用后端新增的API接口。

### 前后端协作规范

- **独立开发**: 前后端可以独立开发。前端根据接口文档使用`axios`调用后端API，后端提供稳定的RESTful接口。
- **接口约定**: 前后端通过约定的API路径、请求方法、请求/响应数据格式进行协作。前端通过`X-User-ID`请求头传递用户身份。
- **跨域处理**: 后端使用`flask_cors`扩展自动处理前端（通常运行在`http://localhost:5173`）的跨域请求。

**Section sources**
- [backend/app.py](file://backend/app.py#L39-L57)
- [frontend/src/api.js](file://frontend/src/api.js#L9-L15)
- [frontend/src/router/index.js](file://frontend/src/router/index.js#L7-L56)